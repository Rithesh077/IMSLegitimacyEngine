// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  FACULTY
  CORPORATE
  PLACEMENT
  STUDENT
  ADMIN
}

enum InternshipStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  CLOSED
}

enum LocationType {
  REMOTE
  ONSITE
  HYBRID
}

model User {
  id         String   @id @default(uuid())
  name       String
  email      String   @unique
  password   String
  role       Role
  created_at DateTime @default(now())

  // Relations
  corporate_profile CorporateProfile?
  internships       Internship[]        @relation("CreatedInternships")
  applications      Application[]
  
  department_id String?
  department    Department? @relation(fields: [department_id], references: [id])
}

model CorporateProfile {
  id           String @id @default(uuid())
  company_name String
  hr_name      String
  email        String 
  
  // New Fields for Legitimacy Pipeline
  country             String   // Mandatory: "India", "USA", etc.
  registration_number String?  // Optional: CIN, EIN, etc.
  linkedin_url        String?
  website_url         String?
  
  is_manually_added   Boolean  @default(false) // Admin Bypass Flag
  verification_report Json?    // Stores the full Admin Report (Score, Rationale, Evidence)

  user_id      String @unique
  user         User   @relation(fields: [user_id], references: [id])

  internships  Internship[]

  @@map("corporate_profiles")
}

model Department {
  id   String @id @default(uuid())
  name String @unique
  
  internships Internship[]
  users       User[]

  @@map("departments")
}

model Internship {
  id          String           @id @default(uuid())
  title       String
  description String
  status      InternshipStatus @default(DRAFT)
  
  // New Fields
  department_id String
  department    Department @relation(fields: [department_id], references: [id])
  
  location_type LocationType
  is_paid       Boolean
  stipend       String?   // Optional: e.g. "10000/month", "Unpaid"
  duration      String    // e.g. "3 months"
  
  created_at  DateTime         @default(now())

  corporate_id String
  corporate    CorporateProfile @relation(fields: [corporate_id], references: [id])
  
  creator_id String?
  creator    User?   @relation("CreatedInternships", fields: [creator_id], references: [id])

  applications Application[]

  @@map("internships")
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  ACCEPTED
  REJECTED
}

model Application {
  id            String            @id @default(uuid())
  resume_link   String
  github_link   String?
  linkedin_link String?
  status        ApplicationStatus @default(PENDING)
  created_at    DateTime          @default(now())

  internship_id String
  internship    Internship @relation(fields: [internship_id], references: [id])

  student_id String
  student    User   @relation(fields: [student_id], references: [id])

  @@map("applications")
}
